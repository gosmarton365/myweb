<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>파일 정리 도구</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
        }
        /* 상단 패널 */
        .top-panel {
            background-color: #1a202c;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap; /* 좁은 폭에서 줄바꿈으로 겹침 방지 */
        }
        .top-panel .title-wrap {
            display: flex;
            align-items: baseline;
            gap: 1rem;
            min-width: 0;
        }
        .top-panel h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #63b3ed;
            margin: 0;
            white-space: nowrap;
        }
        .top-panel p {
            font-size: 1.05rem;
            color: #cbd5e0;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 좌/우 패널 공통 */
        .left-panel {
            overflow-y: auto;
            -ms-overflow-style: none;
            scrollbar-width: none;
            height: calc(100vh - 80px);
        }
        .left-panel::-webkit-scrollbar { display: none; }

        .right-panel {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background-color: #f0f4f8;
            padding: 1.5rem;
            height: calc(100vh - 80px);
        }
        .right-panel-content {
            width: 100%;
            height: 100%;
            flex-grow: 1;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden; /* 내부에 자체 스크롤 */
            padding: 1.5rem;
            display: flex;
            flex-direction: column; /* 기본 세로 */
            justify-content: flex-start;
            align-items: flex-start;
        }
        .right-panel-content.video-layout {
            flex-direction: row; /* 비디오 레이아웃은 가로 분할 */
            padding: 0;
        }

        /* 분할 핸들 (드래그 바) */
        .resize-handle {
            width: 6px;
            cursor: col-resize;
            background: linear-gradient(180deg, #e2e8f0, #cbd5e1);
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.06);
            margin: 0 2px;
            user-select: none;
            touch-action: none;
        }
        .resize-handle::before {
            content: '';
            display: block;
            width: 2px;
            height: 24px;
            margin: 0 auto;
            border-left: 1px solid #94a3b8;
            border-right: 1px solid #94a3b8;
            opacity: .6;
            position: relative;
            top: calc(50% - 12px);
        }

        /* 패널 내부 */
        .video-sub-panel, .side-info-panel {
            height: 100%;
            overflow: hidden; /* 내부 요소가 스스로 스크롤 */
            border-radius: 0.75rem;
        }
        .video-sub-panel {
            background: #f3f4f6;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .side-info-panel {
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .side-info-panel > iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0.75rem;
        }

        video, audio, iframe, pre, table {
            max-width: 100%;
            height: auto;
            display: block;
            object-fit: contain;
        }

        /* 이미지 뷰어 */
        .image-container {
            width: 100%; height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: hidden;
            cursor: grab;
        }
        .image-container.is-dragging { cursor: grabbing; }
        img {
            max-width: none;
            height: auto;
            user-select: none;
            transform-origin: center center;
        }

        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
        th { background-color: #f8fafc; }

        /* 서브메뉴 스크롤 */
        .submenu { max-height: 300px; overflow-y: auto; }
        .submenu::-webkit-scrollbar { width: 8px; }
        .submenu::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 4px; }
        .submenu::-webkit-scrollbar-track { background-color: #2d3748; }
    </style>
</head>
<body class="flex flex-col h-screen">
    <!-- 상단 타이틀 패널 -->
    <div class="top-panel">
        <div class="title-wrap">
            <h1 id="page-title">파일 정리 도구</h1>
            <p id="page-subtitle">JSON 파일을 선택해주세요.</p>
        </div>
        <!-- 파일 선택 버튼을 상단으로 이동 -->
        <div>
            <input
                type="file"
                id="jsonFileInput"
                accept=".json"
                class="block text-sm text-gray-300
                       file:mr-4 file:py-2 file:px-4
                       file:rounded-md file:border-0
                       file:text-sm file:font-semibold
                       file:bg-blue-500 file:text-white
                       hover:file:bg-blue-600 cursor-pointer">
        </div>
    </div>

    <!-- 좌/우 패널 -->
    <div class="flex flex-grow">
        <!-- 왼쪽 메뉴 패널 -->
        <div class="left-panel w-[15%] bg-gray-800 text-white p-4 rounded-r-lg shadow-lg">
            <nav>
                <ul id="main-menu">
                    <!-- 메뉴 항목은 JavaScript에 의해 동적으로 채워집니다. -->
                </ul>
            </nav>
        </div>

        <!-- 오른쪽 콘텐츠 패널 -->
        <div class="right-panel w-[85%]">
            <div id="content-display" class="right-panel-content"></div>
        </div>
    </div>

    <script>
        const contentDisplay = document.getElementById('content-display');
        const mainMenu = document.getElementById('main-menu');
        const pageTitleElement = document.getElementById('page-title');
        const pageSubtitleElement = document.getElementById('page-subtitle');
        const jsonFileInput = document.getElementById('jsonFileInput');

        let currentPageData = null;

        // 안내 카드 HTML (재사용)
        const introCardHTML = `
            <div class="w-full h-full flex items-center justify-center p-6">
              <div class="bg-white rounded-2xl shadow-xl p-8 md:p-10 max-w-xl w-full text-center border border-slate-100">
                <!-- 상단 아이콘 -->
                <div class="mx-auto mb-5 inline-flex items-center justify-center h-14 w-14 rounded-full bg-blue-50 ring-1 ring-inset ring-blue-100">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"
                          d="M8 6h7l3 3v9a2 2 0 0 1-2 2H8m0-14a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2m0-14v14m3-7h6M11 7h2" />
                  </svg>
                </div>
                <!-- 제목 -->
                <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight text-slate-800 mb-2">
                  강의 파일을 불러오세요
                </h2>
                <!-- 보조 문구 -->
                <p class="text-slate-600 mb-5">
                  상단의 <span class="font-semibold">파일 선택</span> 버튼으로
                  <span class="font-semibold">JSON</span> 파일을 선택하면 강의 목록이 열립니다.
                </p>
                <!-- 코드/경로 안내 배지 -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg px-4 py-3 text-left mb-4">
                  <div class="text-sm text-slate-700 mb-1">파일 이름 형식</div>
                  <code class="inline-block bg-white text-blue-700 border border-blue-200 rounded px-2 py-1 text-sm font-mono">
                    수강강의명.json
                  </code>
                </div>
                <p class="text-slate-500 text-sm">
                  JSON 파일은
                  <span class="font-mono text-slate-700">내강의실5.html</span>
                  과 같은 폴더에 있어야 합니다.
                </p>
              </div>
            </div>
        `;

        /**
         * 지정된 경로의 파일을 로드하여 오른쪽 패널에 표시합니다.
         * @param {string} filePath
         * @param {string} fileType - 'video' | 'audio' | 'image' | 'text' | 'csv' | 'pdf' | 'excel' | 'html' | 'powerpoint' | 'document' | 'design' | 'archive'
         */
        async function loadFile(filePath, fileType) {
            console.log(`[loadFile] 파일 로드 시도: 경로=${filePath}, 타입=${fileType}`);
            contentDisplay.innerHTML = '';

            // 공통 초기화 (세로 배치)
            contentDisplay.classList.remove('video-layout');
            contentDisplay.classList.add('p-6');
            contentDisplay.style.display = 'flex';
            contentDisplay.style.flexDirection = 'column';
            contentDisplay.style.justifyContent = 'flex-start';
            contentDisplay.style.alignItems = 'flex-start';

            try {
                if (fileType === 'video' || fileType === 'audio') {
                    const textFilePath = filePath.substring(0, filePath.lastIndexOf('.')) + '.txt';
                    console.log(`[loadFile] 관련 텍스트 파일 경로: ${textFilePath}`);

                    let hasAssociatedTextFile = false;
                    if (currentPageData && Array.isArray(currentPageData.menuItems)) {
                        for (const categoryItem of currentPageData.menuItems) {
                            if (categoryItem.files && Array.isArray(categoryItem.files)) {
                                for (const file of categoryItem.files) {
                                    if (file.path === textFilePath && file.type === 'text') {
                                        hasAssociatedTextFile = true;
                                        break;
                                    }
                                }
                            }
                            if (hasAssociatedTextFile) break;
                        }
                    }
                    console.log(`[loadFile] 관련 텍스트 파일 (${textFilePath}) JSON 데이터에 존재 여부: ${hasAssociatedTextFile}`);

                    if (hasAssociatedTextFile) {
                        // 비디오+텍스트 2분할 레이아웃 활성화
                        contentDisplay.classList.add('video-layout');
                        contentDisplay.classList.remove('p-6');
                        // 인라인 column이 클래스보다 우선하므로 명시적으로 row로 전환
                        contentDisplay.style.flexDirection = 'row';
                        contentDisplay.style.alignItems = 'stretch';
                        contentDisplay.style.justifyContent = 'stretch';

                        // 좌측: 비디오, 우측: 텍스트 iframe
                        const videoPanel = document.createElement('div');
                        videoPanel.classList.add('video-sub-panel');
                        // 초기 비율 70%
                        videoPanel.style.width = '70%';

                        const mediaElement = document.createElement('video');
                        mediaElement.src = filePath;
                        mediaElement.controls = true;
                        mediaElement.autoplay = true;
                        mediaElement.style.width = '100%';
                        mediaElement.style.height = '100%';
                        mediaElement.style.borderRadius = '0.75rem';
                        mediaElement.style.objectFit = 'contain';
                        videoPanel.appendChild(mediaElement);

                        const handle = document.createElement('div');
                        handle.className = 'resize-handle';
                        handle.title = '드래그하여 패널 너비를 조절하세요';

                        const infoPanel = document.createElement('div');
                        infoPanel.classList.add('side-info-panel');
                        // 초기 비율 30%
                        infoPanel.style.width = '30%';
                        infoPanel.style.padding = '1rem';
                        infoPanel.style.overflowY = 'auto';

                        const textIframe = document.createElement('iframe');
                        textIframe.src = textFilePath;
                        infoPanel.appendChild(textIframe);

                        contentDisplay.appendChild(videoPanel);
                        contentDisplay.appendChild(handle);
                        contentDisplay.appendChild(infoPanel);

                        // ===== 가변 분할 로직 (마우스 & 터치) =====
                        const MIN_LEFT = 20;  // %
                        const MAX_LEFT = 85;  // %
                        const HANDLE_WIDTH = 6; // px (CSS와 동일)

                        const startResize = (clientX) => {
                            const rect = contentDisplay.getBoundingClientRect();
                            const total = rect.width;
                            let leftPx = clientX - rect.left;
                            leftPx = Math.max((MIN_LEFT/100)*total, Math.min(leftPx, (MAX_LEFT/100)*total));
                            const leftPercent = (leftPx / total) * 100;

                            videoPanel.style.width = `calc(${leftPercent}% - ${HANDLE_WIDTH/2}px)`;
                            infoPanel.style.width = `calc(${100 - leftPercent}% - ${HANDLE_WIDTH/2}px)`;
                        };

                        const onMouseMove = (e) => {
                            e.preventDefault();
                            startResize(e.clientX);
                        };
                        const onMouseUp = () => {
                            window.removeEventListener('mousemove', onMouseMove);
                            window.removeEventListener('mouseup', onMouseUp);
                            document.body.style.cursor = '';
                            handle.style.cursor = 'col-resize';
                        };

                        handle.addEventListener('mousedown', (e) => {
                            e.preventDefault();
                            document.body.style.cursor = 'col-resize';
                            window.addEventListener('mousemove', onMouseMove);
                            window.addEventListener('mouseup', onMouseUp);
                        });

                        // 터치 지원
                        const onTouchMove = (e) => {
                            if (!e.touches || e.touches.length === 0) return;
                            startResize(e.touches[0].clientX);
                        };
                        const onTouchEnd = () => {
                            window.removeEventListener('touchmove', onTouchMove);
                            window.removeEventListener('touchend', onTouchEnd);
                        };
                        handle.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            window.addEventListener('touchmove', onTouchMove, { passive: false });
                            window.addEventListener('touchend', onTouchEnd);
                        });
                        // ===== 가변 분할 로직 끝 =====

                        console.log(`[loadFile] 비디오/오디오 파일 로드 + 가변 분할 구성 (텍스트 파일 있음): ${filePath}`);
                    } else {
                        const mediaElement = document.createElement('video');
                        mediaElement.src = filePath;
                        mediaElement.controls = true;
                        mediaElement.autoplay = true;
                        mediaElement.classList.add('w-full','h-full','rounded-lg');
                        mediaElement.style.objectFit = 'contain';
                        contentDisplay.appendChild(mediaElement);
                        console.log(`[loadFile] 비디오/오디오 파일 로드 (텍스트 파일 없음, 100%): ${filePath}`);
                    }
                } else if (fileType === 'image') {
                    // 이미지 컨테이너
                    contentDisplay.style.justifyContent = 'center';
                    contentDisplay.style.alignItems = 'flex-start';
                    contentDisplay.classList.remove('p-6');
                    contentDisplay.innerHTML = '';

                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('image-container');
                    imageContainer.style.position = 'relative';

                    const imageElement = document.createElement('img');
                    imageElement.src = filePath;
                    imageElement.alt = "확대/축소 가능한 이미지";
                    imageElement.classList.add('transition-transform','duration-100');
                    imageElement.style.transform = 'scale(1)';
                    imageContainer.appendChild(imageElement);
                    contentDisplay.appendChild(imageContainer);

                    let scale = 1, isDragging = false;
                    let startX = 0, startY = 0, offsetX = 0, offsetY = 0;

                    imageElement.onload = () => {
                        const panelWidth = contentDisplay.querySelector('.image-container').clientWidth;
                        const naturalWidth = imageElement.naturalWidth;
                        if (naturalWidth > panelWidth) {
                            imageElement.style.width = '100%';
                        } else {
                            imageElement.style.width = `${naturalWidth}px`;
                        }
                    };

                    imageContainer.addEventListener('wheel', (e) => {
                        e.preventDefault();
                        const zoomSpeed = 0.1;
                        scale += (e.deltaY < 0) ? zoomSpeed : -zoomSpeed;
                        scale = Math.max(0.2, Math.min(scale, 5));
                        imageElement.style.transform = `scale(${scale}) translate(${offsetX}px, ${offsetY}px)`;
                    });

                    imageContainer.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        isDragging = true;
                        imageContainer.classList.add('is-dragging');
                        startX = e.clientX - offsetX * scale;
                        startY = e.clientY - offsetY * scale;
                    });
                    imageContainer.addEventListener('mousemove', (e) => {
                        if (!isDragging) return;
                        e.preventDefault();
                        offsetX = (e.clientX - startX) / scale;
                        offsetY = (e.clientY - startY) / scale;
                        imageElement.style.transform = `scale(${scale}) translate(${offsetX}px, ${offsetY}px)`;
                    });
                    imageContainer.addEventListener('mouseup', () => {
                        isDragging = false;
                        imageContainer.classList.remove('is-dragging');
                    });
                    imageContainer.addEventListener('mouseleave', () => {
                        isDragging = false;
                        imageContainer.classList.remove('is-dragging');
                    });

                } else if (fileType === 'text' || fileType === 'html' || fileType === 'pdf') {
                    const iframeElement = document.createElement('iframe');
                    iframeElement.src = filePath;
                    iframeElement.classList.add('w-full','h-full','rounded-lg');
                    iframeElement.style.border = 'none';
                    contentDisplay.appendChild(iframeElement);
                    console.log(`[loadFile] ${fileType} 파일 로드 성공: ${filePath}`);
                } else if (['csv','excel','powerpoint','document','design','archive'].includes(fileType)) {
                    contentDisplay.classList.add('justify-center','items-center','flex-col');

                    const linkElement = document.createElement('a');
                    linkElement.href = filePath;
                    linkElement.download = filePath.split('/').pop();
                    linkElement.textContent = `"${linkElement.download}" 파일 다운로드`;
                    linkElement.classList.add('text-blue-500','hover:underline','text-lg','font-medium','block','text-center','mt-8');
                    contentDisplay.appendChild(linkElement);

                    const pElement = document.createElement('p');
                    pElement.textContent = '이 파일 형식은 웹 브라우저에서 직접 재생하거나 표시할 수 없습니다. 다운로드하여 확인해주세요.';
                    pElement.classList.add('text-gray-600','text-center','mt-4');
                    contentDisplay.appendChild(pElement);
                    console.log(`[loadFile] 다운로드 링크 생성 (타입: ${fileType}): ${filePath}`);
                } else {
                    contentDisplay.innerHTML = '<p class="text-red-500">지원되지 않는 파일 형식입니다.</p>';
                    console.warn(`[loadFile] 지원되지 않는 파일 형식: ${fileType} (경로: ${filePath})`);
                }
            } catch (error) {
                console.error('[loadFile] 파일 로드 중 오류 발생:', error);
                contentDisplay.innerHTML = `<p class="text-red-500 text-center">파일을 로드할 수 없습니다: ${error.message}. 경로를 확인하세요.</p>`;
            }
        }

        /**
         * JSON 데이터를 기반으로 페이지 타이틀, 부제목, 메뉴를 렌더링합니다.
         */
        function renderPageContent(pageData) {
            console.log('[renderPageContent] JSON 데이터 파싱 완료, 렌더링 시작:', pageData);
            currentPageData = pageData;

            pageTitleElement.textContent = pageData.pageTitle || '제목 없음';
            pageSubtitleElement.textContent = pageData.pageSubtitle || '';

            mainMenu.innerHTML = '';

            if (pageData.menuItems && Array.isArray(pageData.menuItems)) {
                pageData.menuItems.forEach((menuItem) => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('mb-4');

                    const button = document.createElement('button');
                    button.classList.add('w-full','text-left','py-3','px-4','rounded-lg','font-medium','text-lg','transition','duration-200');
                    button.textContent = menuItem.title;

                    if (menuItem.link) {
                        button.classList.add('bg-blue-600','hover:bg-blue-700','text-white');
                        button.onclick = () => window.open(menuItem.link, '_blank');
                        listItem.appendChild(button);
                    } else if (menuItem.files) {
                        button.classList.add('menu-toggle','bg-gray-700','hover:bg-gray-600','text-white');
                        button.dataset.target = menuItem.category + '-menu';
                        listItem.appendChild(button);

                        const submenuElement = document.createElement('ul');
                        submenuElement.id = menuItem.category + '-menu';
                        submenuElement.classList.add('submenu','hidden','mt-2','ml-4');
                        listItem.appendChild(submenuElement);

                        // 같은 이름의 동영상/오디오가 있는 텍스트(.txt)는 메뉴에서 숨김
                        const videoAudioBaseNames = new Set();
                        menuItem.files.forEach(file => {
                            if (file.type === 'video' || file.type === 'audio') {
                                const baseName = file.name.substring(0, file.name.lastIndexOf('.'));
                                videoAudioBaseNames.add(baseName);
                            }
                        });

                        if (Array.isArray(menuItem.files)) {
                            menuItem.files.forEach((file) => {
                                if (file.type === 'text') {
                                    const baseName = file.name.substring(0, file.name.lastIndexOf('.'));
                                    if (videoAudioBaseNames.has(baseName)) return;
                                }
                                const fileListItem = document.createElement('li');
                                const fileLink = document.createElement('button');
                                fileLink.textContent = file.name;
                                fileLink.classList.add('w-full','text-left','py-2','px-3','text-gray-300','hover:bg-gray-600','hover:text-white','rounded-md','transition','duration-150','text-sm');
                                fileLink.onclick = () => loadFile(file.path, file.type);
                                fileListItem.appendChild(fileLink);
                                submenuElement.appendChild(fileListItem);
                            });
                        }
                    } else if (menuItem.subItems && Array.isArray(menuItem.subItems)) {
                        button.classList.add('menu-toggle','bg-gray-700','hover:bg-gray-600','text-white');
                        button.dataset.target = menuItem.category + '-menu';
                        listItem.appendChild(button);

                        const submenuElement = document.createElement('ul');
                        submenuElement.id = menuItem.category + '-menu';
                        submenuElement.classList.add('submenu','hidden','mt-2','ml-4');
                        listItem.appendChild(submenuElement);

                        menuItem.subItems.forEach((subItem) => {
                            const subListItem = document.createElement('li');
                            const subButton = document.createElement('button');
                            subButton.classList.add('w-full','text-left','py-2','px-3','text-gray-300','hover:bg-gray-600','hover:text-white','rounded-md','transition','duration-150','text-sm','font-medium');
                            subButton.textContent = subItem.title;
                            subButton.dataset.target = menuItem.category + '-' + subItem.title.replace(/\s/g, '') + '-submenu';
                            subButton.classList.add('menu-toggle');
                            subListItem.appendChild(subButton);

                            const nestedSubmenuElement = document.createElement('ul');
                            nestedSubmenuElement.id = subButton.dataset.target;
                            nestedSubmenuElement.classList.add('submenu','hidden','mt-2','ml-4');
                            subListItem.appendChild(nestedSubmenuElement);

                            if (subItem.files && Array.isArray(subItem.files)) {
                                subItem.files.forEach((file) => {
                                    const fileListItem = document.createElement('li');
                                    const fileLink = document.createElement('button');
                                    fileLink.textContent = file.name;
                                    fileLink.classList.add('w-full','text-left','py-2','px-3','text-gray-400','hover:bg-gray-600','hover:text-white','rounded-md','transition','duration-150','text-xs');
                                    fileLink.onclick = () => loadFile(file.path, file.type);
                                    fileListItem.appendChild(fileLink);
                                    nestedSubmenuElement.appendChild(fileListItem);
                                });
                            }
                            submenuElement.appendChild(subListItem);
                        });
                    }
                    mainMenu.appendChild(listItem);
                });
            } else {
                console.error('[renderPageContent] pageData.menuItems가 유효한 배열이 아닙니다.');
                pageTitleElement.textContent = '데이터 오류';
                pageSubtitleElement.textContent = '메뉴 데이터를 로드할 수 없습니다.';
            }

            // 아코디언 열기/닫기
            document.querySelectorAll('.menu-toggle').forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.dataset.target;
                    const targetSubmenu = document.getElementById(targetId);

                    document.querySelectorAll('.submenu').forEach(submenu => {
                        let isParentOfClicked = false;
                        let currentElement = targetSubmenu;
                        while(currentElement) {
                            if (currentElement?.id === submenu.id) {
                                isParentOfClicked = true;
                                break;
                            }
                            currentElement = currentElement?.parentElement?.closest('.submenu');
                        }
                        if (submenu.id !== targetId && !isParentOfClicked) {
                            submenu.classList.add('hidden');
                        }
                    });

                    if (targetSubmenu) targetSubmenu.classList.toggle('hidden');
                });
            });
        }

        // 초기 문구 및 상태
        document.addEventListener('DOMContentLoaded', () => {
            pageTitleElement.textContent = '파일 정리 도구';
            pageSubtitleElement.textContent = 'JSON 파일을 선택해주세요.';
            mainMenu.innerHTML = '';
            contentDisplay.innerHTML = introCardHTML;
            console.log('[DOMContentLoaded] 초기 페이지 설정 완료.');
        });

        // 파일 선택 핸들러
        jsonFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            console.log('[jsonFileInput] 파일 선택됨:', file ? file.name : '없음');

            // 파일 선택 직후, 아직 렌더 전에는 안내 카드 유지
            contentDisplay.innerHTML = introCardHTML;

            if (file) {
                const reader = new FileReader();

                reader.onload = (e) => {
                    try {
                        const pageData = JSON.parse(e.target.result);
                        console.log('[jsonFileInput] JSON 파일 파싱 성공:', pageData);
                        renderPageContent(pageData);
                    } catch (parseError) {
                        console.error('[jsonFileInput] JSON 파일 파싱 오류:', parseError);
                        pageTitleElement.textContent = 'JSON 파싱 오류';
                        pageSubtitleElement.textContent = '선택된 파일이 유효한 JSON 형식이 아닙니다.';
                        mainMenu.innerHTML = '';
                        contentDisplay.innerHTML = '<p class="text-red-500 text-center text-xl">JSON 파싱 오류: 선택된 파일이 유효한 JSON 형식이 아닙니다.</p>';
                    }
                };

                reader.onerror = (readError) => {
                    console.error('[jsonFileInput] 파일 읽기 오류:', readError);
                    pageTitleElement.textContent = '파일 읽기 오류';
                    pageSubtitleElement.textContent = '파일을 읽는 중 오류가 발생했습니다.';
                    mainMenu.innerHTML = '';
                    contentDisplay.innerHTML = '<p class="text-red-500 text-center text-xl">파일 읽기 오류: 파일을 읽는 중 오류가 발생했습니다.</p>';
                };

                reader.readAsText(file);
            } else {
                pageTitleElement.textContent = '파일을 선택해주세요';
                pageSubtitleElement.textContent = '';
                mainMenu.innerHTML = '';
                contentDisplay.innerHTML = introCardHTML;
            }
        });
    </script>
</body>
</html>
